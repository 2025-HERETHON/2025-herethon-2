{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>detail_challenge</title>
    <link rel="stylesheet" href="{% static 'css/detail_ch.css' %}" />
</head>
<body>
    <div class="wrap">
        <!-- 챌린지 정보 -->
        <div class="header">
            <div id="challenges">
              <div class="card-top">
                <h3 class="card-title">{{ challenge.challenge_name }}</h3>
                <div class="pn">
                  <div><img class="img1" src="{% static 'images/challenges/img1.svg' %}" /></div>
                  <div class="card-pn">{{ challenge.participant_num }}</div>
                </div>
              </div>
              <div class="dsc">
                <p class="card-dsc">{{ challenge.description }}</p>
              </div>
            </div>
        </div>
        <!-- 챌린지 정보 끝 -->

        <!-- 피드들 -->
        <div class="scroll-area">
        {% for feed in feeds %}
        <div class="feed">
          <div class="feedheader">
            <div class="nickname">{{ feed.writer.nickname }}</div>
            <div class="created_at">{{ feed.created_at|date:"n월 j일 H:i" }}</div>
          </div>

          <div class="carousel" id="carousel-{{ feed.id }}">
            <div class="image">
              {% for image in feed.images.all %}
                <img class="carousel-img feed-{{ feed.id }} {% if forloop.first %}active{% endif %}" src="{{ image.image.url }}" />
              {% endfor %}
            </div>
            <div class="dots">
              {% for image in feed.images.all %}
                <span class="dot {% if forloop.first %}dotactive{% endif %}" onclick="showSlide({{ feed.id }}, {{ forloop.counter0 }})"></span>
              {% endfor %}
            </div>
          </div>

          <div class="icon">
            <div class="like">
              <div class="likeicon"><img src="{% static 'images/challenges/img7.svg' %}" /></div>
              <div class="like_count">5</div>
            </div>
            <div class="comment">
              <div class="commenticon" onclick="openCommentModal()"><img src="{% static 'images/challenges/img8.svg' %}" /></div>
              <div class="comment_count">2</div>
            </div>
          </div>
          
          <!-- 피드별 코멘트 모달 -->
          <div id="commentModal" class="modal-overlay" style="display: none;">
            <div class="commentmodal-box">
              <div class="c-feed">
                <div class="feedheader">
                  <div class="nickname">{{ feed.writer.nickname }}</div>
                  <div class="created_at">{{ feed.created_at|date:"n월 j일 H:i" }}</div>
                </div>
                <span class="content">{{ feed.content }}</span>
                <div class="icon">
                  <div class="like">
                    <div class="likeicon"><img src="{% static 'images/challenges/img7.svg' %}" /></div>
                    <div class="like_count">5</div>
                  </div>
                  <div class="comment">
                    <div class="commenticon"><img src="{% static 'images/challenges/img9.svg' %}" /></div>
                  <div class="comment_count">2</div>
                </div>
              </div>
            </div>

            <div class="comment-scroll-area">
            {% for comment in feed.comments.all %}
              <div class="commentcard" data-comment-id="{{ comment.id }}">
                <hr style="border: none; height: 1px; background-color: #ccc;" />
                <div class="c-cardheader">
                  <div class="writerdot">
                    <div class="writer">{{ comment.writer.nickname }}</div>
                    {% comment %} <div class="c-dot"></div> {% endcomment %}
                  </div>
                  <div class="date">{{ comment.created_at|date:"n월 j일 H:i" }}</div>
                </div>
                <div class="c-content">{{ comment.content }}</div>
              </div>
            {% empty %}
            <p style="padding: 1rem; color: #999;">아직 댓글이 없습니다.</p>
            {% endfor %}
              <div class="addcomment">
                <input class="c-input" id="c-input" type="text" />
                <button class="send-btn"><img src="{% static 'images/challenges/img10.svg' %}"/></button>
              </div>
            </div>
          </div>

        </div>
          <span class="content">{{ feed.content }}</span>
        </div>
        {% endfor %}
        </div>
        <!-- 피드 끝 -->

        <button id="joinbtn" class="joinbtn" onclick="openModal()">
          <div id="jointext" class="jointext">가입하기</div>
        </button>

        <div id="chjoinmodal" class="modal-overlay" style="display:none;">
          <div class="modal-content">
            <span class="chjoinmodaltext1">'{{ challenge.challenge_name }}' 그룹에</span>
            <span class="chjoinmodaltext2">가입하시겠습니까?</span>
            <div class="mdjoinbtn">
              <button class="okbtn" onClick="convertWrite()"><div class="oktext">확인</div></button>
              <button class="ccbtn" onclick="closeModal()"><div class="cctext">취소</div></button>
            </div>
          </div>
        </div>
    
        {% comment %} <div id="delete" class="delete hidden">
            <div class="delete-content">
              <button id="edit-btn">
                <span class="text1">수정</span>
                <img src="{% static 'images/challenges/img11.svg' %}"/>
              </button>
              <button id="delete-btn" onclick="openConfirmModal()">
                <span class="text2">삭제</span>
                <img src="{% static 'images/challenges/img12.svg' %}"/>
              </button>
          </div>

          <div id="confirmModal" class="cf-modal-overlay hidden">
            <div class="confirm-box">
              <p class="confirm-message">해당 댓글을 삭제하시겠습니까?</p>
              <div class="confirm-buttons">
                <button id="confirmDeleteBtn" class="confirm-ok" onclick="confirmDelete()">확인</button>
                <button id="cancelDeleteBtn" class="confirm-cancel" onclick="cancelDelete()">취소</button>
              </div>
            </div>
          </div> {% endcomment %}
    </div>
    <script src="{% static 'js/detail_ch.js' %}"></script>
</body>
</html>