{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <base href="/" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-393, initial-scale=0.9" />
    <title>detail_challenge</title>

    <link rel="stylesheet" href="{% static 'css/detail_ch.css' %}" />
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <meta name="csrf-token" content="{{ csrf_token }}">
  </head>
  <body>
   <div id="root">
    {% csrf_token %}
    <div class="wrap">
      <!-- ì±Œë¦°ì§€ ì •ë³´ -->
      <div class="challenge-container">
        {% include "navbar.html" %}
        <div class="header">
          <div id="challenges">
            <div class="card-top">
              <h3 class="card-title">{{ challenge.challenge_name }}</h3>
              <div class="pn">
                <div>
                  <img
                    class="img1"
                    src="{% static 'images/challenges/img1.svg' %}"
                  />
                </div>
                <div class="card-pn">{{ challenge.participant_num }}</div>
              </div>
            </div>
            <div class="dsc">
              <p class="card-dsc">{{ challenge.description }}</p>
            </div>
          </div>
        </div>
        <!-- ì±Œë¦°ì§€ ì •ë³´ ë -->

        <!-- í”¼ë“œë“¤ -->
        <div class="scroll-area">
          {% for feed in feeds %}
          <div class="feed">
            <div class="feedheader">
              <div class="nickname">{{ feed.writer.nickname }}</div>
              <div class="created_at">
                {{ feed.created_at|date:"nì›” jì¼ H:i" }}
              </div>
            </div>

            <div class="carousel" id="carousel-{{ feed.id }}">
              <div class="image">
                {% for image in feed.images.all %}
                <img
                  class="carousel-img feed-{{ feed.id }} {% if forloop.first %}active{% endif %}"
                  src="{{ image.image.url }}"
                />
                {% endfor %}
              </div>
              <div class="dots">
                {% for image in feed.images.all %}
                <span
                  class="dot {% if forloop.first %}dotactive{% endif %}"
                  onclick="showSlide({{ feed.id }}, {{ forloop.counter0 }})"
                ></span>
                {% endfor %}
              </div>
            </div>

            <div class="icon">
              <div class="like">
                <div class="likeicon" onclick="addLike({{ feed.id }})">
                  {% if feed.is_liked %}
                  <img src="{% static 'images/challenges/img13.svg' %}" />
                  {% else %}
                  <img src="{% static 'images/challenges/img7.svg' %}" />
                  {% endif %}
                </div>
                <div class="like_count">{{ feed.like.count }}</div>
              </div>
              <div class="comment">
                <div
                  class="commenticon"
                  onclick="openCommentModal({{ feed.id }})"
                >
                  <img src="{% static 'images/challenges/img8.svg' %}" />
                </div>
                <div class="comment_count">{{ feed.comments.count }}</div>
              </div>
            </div>

            <!-- í”¼ë“œë³„ ì½”ë©˜íŠ¸ ëª¨ë‹¬ -->
            <div
              id="commentModal-{{ feed.id }}"
              class="modal-overlay"
              style="display: none"
            >
              <div class="commentmodal-box">
                <div class="c-feed">
                  <div class="feedheader">
                    <div class="nickname">{{ feed.writer.nickname }}</div>
                    <div class="created_at">
                      {{ feed.created_at|date:"nì›” jì¼ H:i" }}
                    </div>
                  </div>
                  <span class="content">{{ feed.content }}</span>
                  <div class="icon">
                    <div class="like">
                      <div class="likeicon" onclick="addLike({{ feed.id }})">
                        {% if feed.is_liked %}
                        <img src="{% static 'images/challenges/img13.svg' %}" />
                        {% else %}
                        <img src="{% static 'images/challenges/img7.svg' %}" />
                        {% endif %}
                      </div>
                      <div class="like_count">{{ feed.like.count }}</div>
                    </div>
                    <div class="comment">
                      <div class="commenticon">
                        <img src="{% static 'images/challenges/img9.svg' %}" />
                      </div>
                      <div class="comment_count">{{ feed.comments.count }}</div>
                    </div>
                  </div>
                </div>

                  <div class="comment-scroll-area">
                  {% for comment in feed.comments.all %}
                  <div class="commentcard" data-comment-id="{{ comment.id }}">
                    <hr
                      style="border: none; height: 1px; background-color: #ccc"
                    />
                    <div class="c-cardheader">
                      <div class="writerdot">
                        <div class="writer">{{ comment.writer.nickname }}</div>
                        {% if comment.writer == user %}
                        <div class="c-dot" data-comment-id="{{comment.id}}"></div>
                        {% endif %}
                      </div>
                      <div class="date">
                        {{ comment.created_at|date:"nì›” jì¼ H:i" }}
                      </div>
                    </div>
                    <div class="c-content" id="comment-content-{{ comment.id }}">{{ comment.content }}</div>
                  </div>
                  {% empty %}
                  <p style="padding: 1rem; color: #999">
                    ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                  </p>
                  {% endfor %}

                  </div>

                  <div class="addcomment">
                    <input
                      class="c-input"
                      id="c-input-{{ feed.id }}"
                      type="text"
                    />
                    <button
                      class="send-btn"
                      onclick="addComment( {{ challenge.id }}, {{ feed.id }})"
                    >
                      <img src="{% static 'images/challenges/img10.svg' %}" />
                    </button>
                  </div>
              </div>
            </div>
            <span class="content">{{ feed.content }}</span>
          </div>
          {% endfor %}
        </div>
        {% for feed in feeds %}
          {% for comment in feed.comments.all %}
            {% if comment.writer == user %}
              <div id="delete-{{ comment.id }}" class="delete hidden">
                <div class="delete-content">
                  <button class="edit-btn" onclick="editComment({{ comment.id }})">
                    <span class="text1">ìˆ˜ì •</span>
                    <img src="{% static 'images/challenges/img11.svg' %}" />
                  </button>
                  <button class="delete-btn" onclick="openConfirmModal({{ comment.id }})">
                    <span class="text2">ì‚­ì œ</span>
                    <img src="{% static 'images/challenges/img12.svg' %}" />
                  </button>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}

        <!-- í”¼ë“œ ë -->

        {% comment %}
        <button id="joinbtn" class="joinbtn" onclick="openModal()">
          <div id="jointext" class="jointext">ê°€ì…í•˜ê¸°</div>
        </button>
        {% endcomment %}
        <button
          id="joinbtn"
          class="joinbtn"
          onclick="{% if is_joined %}location.href='/challenges/create-feed/{{ challenge.id }}/'{% else %}openModal(){% endif %}"
        >
          <div id="jointext" class="jointext">
            {% if is_joined %}ê¸€ì“°ê¸°{% else %}ê°€ì…í•˜ê¸°{% endif %}
          </div>
        </button>

        <div id="chjoinmodal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <span class="chjoinmodaltext1"
              >'{{ challenge.challenge_name }}' ê·¸ë£¹ì—</span
            >
            <span class="chjoinmodaltext2">ê°€ì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</span>
            <div class="mdjoinbtn">
              <button class="okbtn" onClick="convertWrite({{ challenge.id }})">
                <div class="oktext">í™•ì¸</div>
              </button>
              <button class="ccbtn" onclick="closeModal()">
                <div class="cctext">ì·¨ì†Œ</div>
              </button>
            </div>
          </div>
        </div>
        
        {% comment %}
        <div id="confirmModal" class="cf-modal-overlay" style="display: none">
          <div class="confirm-box">
            <span class="confirm-message">í•´ë‹¹ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</span>
            <div class="confirm-buttons">
              <button class="confirm-ok" >
                <div class="c-oktext">í™•ì¸</div>
              </button>
              <button class="confirm-cancel">
                <div class="c-cctext">ì·¨ì†Œ</div>
              </button>
            </div>
          </div>
        </div>
        {% endcomment %}

        

        <div id="tree" class="tree">
            <span class="treetext">ë‚˜ë¬´ 1ê·¸ë£¨ë¥¼ ì‹¬ì—ˆì–´ìš”!</span>
        </div>

        {% if feed_success %}
        <div id="tree" class="tree">
            <span class="treetext">ë‚˜ë¬´ 1ê·¸ë£¨ë¥¼ ì‹¬ì—ˆì–´ìš”!</span>
        </div>
        <script>console.log("ğŸŒ³ ëª¨ë‹¬ì´ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤");</script>
        {% endif %}

    </div>
   </div>
    <script type="module" src="{% static 'js/main.js' %}"></script>
    <script type="module" src="{% static 'js/detail_ch.js' %}"></script>

  </body>
</html>